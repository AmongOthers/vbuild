
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

<style>
*[data-comp] { background: #FFE; border: 1px solid black; margin: 12px; padding: 12px; }

*[data-mother] { border: 2px solid green; margin: 12px; padding: 12px; }
</style>
<script type="text/x-template" id="tpl-comp"><div data-comp>
        {{name}} ({{originalName}})
        <button @click="inc(3)">+3</button>
        <button @click="inc()">+1</button>
        {{cpt}} : {{ccpt}} {{wcpt}}
    </div></script>
<script type="text/x-template" id="tpl-mother"><div data-mother>
        {{id}} <button @click="change()"><- change</button>
        <comp :name="id"></comp>
        <comp name="n2"></comp>
        <comp></comp>
    </div></script>
<script>
var comp=(function() {

    var _pyfunc_format = function (v, fmt) {  // nargs: 2
    fmt = fmt.toLowerCase();
    var s = String(v);
    if (fmt.indexOf('!r') >= 0) {
        try { s = JSON.stringify(v); } catch (e) { s = undefined; }
        if (typeof s === 'undefined') { s = v._IS_COMPONENT ? v.id : String(v); }
    }
    var fmt_type = '';
    if (fmt.slice(-1) == 'i' || fmt.slice(-1) == 'f' ||
        fmt.slice(-1) == 'e' || fmt.slice(-1) == 'g') {
            fmt_type = fmt[fmt.length-1]; fmt = fmt.slice(0, fmt.length-1);
    }
    var i0 = fmt.indexOf(':');
    var i1 = fmt.indexOf('.');
    var spec1 = '', spec2 = '';  // before and after dot
    if (i0 >= 0) {
        if (i1 > i0) { spec1 = fmt.slice(i0+1, i1); spec2 = fmt.slice(i1+1); }
        else { spec1 = fmt.slice(i0+1); }
    }
    // Format numbers
    if (fmt_type == '') {
    } else if (fmt_type == 'i') { // integer formatting, for %i
        s = parseInt(v).toFixed(0);
    } else if (fmt_type == 'f') {  // float formatting
        v = parseFloat(v);
        var decimals = spec2 ? Number(spec2) : 6;
        s = v.toFixed(decimals);
    } else if (fmt_type == 'e') {  // exp formatting
        v = parseFloat(v);
        var precision = (spec2 ? Number(spec2) : 6) || 1;
        s = v.toExponential(precision);
    } else if (fmt_type == 'g') {  // "general" formatting
        v = parseFloat(v);
        var precision = (spec2 ? Number(spec2) : 6) || 1;
        // Exp or decimal?
        s = v.toExponential(precision-1);
        var s1 = s.slice(0, s.indexOf('e')), s2 = s.slice(s.indexOf('e'));
        if (s2.length == 3) { s2 = 'e' + s2[1] + '0' + s2[2]; }
        var exp = Number(s2.slice(1));
        if (exp >= -4 && exp < precision) { s1=v.toPrecision(precision); s2=''; }
        // Skip trailing zeros and dot
        var j = s1.length-1;
        while (j>0 && s1[j] == '0') { j-=1; }
        s1 = s1.slice(0, j+1);
        if (s1.slice(-1) == '.') { s1 = s1.slice(0, s1.length-1); }
        s = s1 + s2;
    }
    // prefix/padding
    var prefix = '';
    if (spec1) {
        if (spec1[0] == '+' && v > 0) { prefix = '+'; spec1 = spec1.slice(1); }
        else if (spec1[0] == ' ' && v > 0) { prefix = ' '; spec1 = spec1.slice(1); }
    }
    if (spec1 && spec1[0] == '0') {
        var padding = Number(spec1.slice(1)) - (s.length + prefix.length);
        s = '0'.repeat(Math.max(0, padding)) + s;
    }
    return prefix + s;
};
var _pyfunc_op_add = function (a, b) { // nargs: 2
    if (Array.isArray(a) && Array.isArray(b)) {
        return a.concat(b);
    } return a + b;
};
var _pyfunc_op_instantiate = function (ob, args) { // nargs: 2
    if ((typeof ob === "undefined") ||
            (typeof window !== "undefined" && window === ob) ||
            (typeof global !== "undefined" && global === ob))
            {throw "Class constructor is called as a function.";}
    for (var name in ob) {
        if (Object[name] === undefined &&
            typeof ob[name] === 'function' && !ob[name].nobind) {
            ob[name] = ob[name].bind(ob);
            ob[name].__name__ = name;
        }
    }
    if (ob.__init__) {
        ob.__init__.apply(ob, args);
    }
};
var _pyfunc_op_mult = function (a, b) { // nargs: 2
    if ((typeof a === 'number') + (typeof b === 'number') === 1) {
        if (a.constructor === String) return _pymeth_repeat.call(a, b);
        if (b.constructor === String) return _pymeth_repeat.call(b, a);
        if (Array.isArray(b)) {var t=a; a=b; b=t;}
        if (Array.isArray(a)) {
            var res = []; for (var i=0; i<b; i++) res = res.concat(a);
            return res;
        }
    } return a * b;
};
var _pymeth_format = function () {
    if (this.constructor !== String) return this.format.apply(this, arguments);
    var parts = [], i = 0, i1, i2;
    var itemnr = -1;
    while (i < this.length) {
        // find opening
        i1 = this.indexOf('{', i);
        if (i1 < 0 || i1 == this.length-1) { break; }
        if (this[i1+1] == '{') {parts.push(this.slice(i, i1+1)); i = i1 + 2; continue;}
        // find closing
        i2 = this.indexOf('}', i1);
        if (i2 < 0) { break; }
        // parse
        itemnr += 1;
        var fmt = this.slice(i1+1, i2);
        var index = fmt.split(':')[0].split('!')[0];
        index = index? Number(index) : itemnr
        var s = _pyfunc_format(arguments[index], fmt);
        parts.push(this.slice(i, i1), s);
        i = i2 + 1;
    }
    parts.push(this.slice(i));
    return parts.join('');
};
var _pymeth_repeat = function(count) { // nargs: 0
    if (this.repeat) return this.repeat(count);
    if (count < 1) return '';
    var result = '', pattern = this.valueOf();
    while (count > 1) {
        if (count & 1) result += pattern;
        count >>= 1, pattern += pattern;
    }
    return result + pattern;
};
var C;
C = function () {
    _pyfunc_op_instantiate(this, arguments);
}
C.prototype._base_class = Object;
C.prototype.__name__ = "C";

C.prototype.__init__ = function (name) {
    name = (name === undefined) ? "?": name;
    console.log("DATA INIT" + " " + name);
    this.cpt = 0;
    this.wcpt = "";
    this.originalName = name;
    return null;
};

C.prototype.inc = async function (nb) {
    nb = (nb === undefined) ? 1: nb;
    console.log((_pymeth_format.call("inc({})", nb)) + " " + this.name);
    this.cpt = _pyfunc_op_add(this.cpt, nb);
    return null;
};

C.prototype.CREATED = function () {
    console.log("CREATED" + " " + this.name);
    return null;
};

C.prototype.MOUNTED = function () {
    console.log("mounted" + " " + this.name + " " + "in" + " " + ((this["$parent"]["$options"]).name));
    return null;
};

C.prototype.COMPUTED_ccpt = function () {
    console.log("COMPUTE" + " " + this.name + " " + this.cpt + " " + "changed");
    return _pyfunc_op_mult(this.cpt, "#");
};

C.prototype.WATCH_1 = function (newVal, oldVal, name) {
    name = (name === undefined) ? "cpt": name;
    console.log("WATCH" + " " + this.name + " " + name + " " + oldVal + " " + "-->" + " " + newVal);
    this.wcpt = _pyfunc_op_mult(this.cpt, "+");
    return null;
};

C.prototype.WATCH_2 = function (newVal, oldVal, name) {
    name = (name === undefined) ? "name": name;
    console.log("WATCH" + " " + name + " " + oldVal + " " + "-->" + " " + newVal);
    return null;
};



    return Vue.component('comp',{
        "name": comp,
        "props": ['name'],
        "template": `#tpl-comp`,
        "data": function() {
            var props=[]
            for(var n of ['name']) props.push( this.$props[n] )
            var i = new C(...props)
            return JSON.parse(JSON.stringify( i ));
        },
        "computed": {
            "ccpt": C.prototype.COMPUTED_ccpt,
        },
        "methods": {
            "inc": C.prototype.inc,
        },
        "watch": {
            "cpt": C.prototype.WATCH_1,
"name": C.prototype.WATCH_2,
        },
        "created": C.prototype.CREATED,
"mounted": C.prototype.MOUNTED,
    })
})();

    

var mother=(function() {

    var _pyfunc_op_add = function (a, b) { // nargs: 2
    if (Array.isArray(a) && Array.isArray(b)) {
        return a.concat(b);
    } return a + b;
};
var _pyfunc_op_instantiate = function (ob, args) { // nargs: 2
    if ((typeof ob === "undefined") ||
            (typeof window !== "undefined" && window === ob) ||
            (typeof global !== "undefined" && global === ob))
            {throw "Class constructor is called as a function.";}
    for (var name in ob) {
        if (Object[name] === undefined &&
            typeof ob[name] === 'function' && !ob[name].nobind) {
            ob[name] = ob[name].bind(ob);
            ob[name].__name__ = name;
        }
    }
    if (ob.__init__) {
        ob.__init__.apply(ob, args);
    }
};
var C;
C = function () {
    _pyfunc_op_instantiate(this, arguments);
}
C.prototype._base_class = Object;
C.prototype.__name__ = "C";

C.prototype.__init__ = function () {
    this.id = "n";
    return null;
};

C.prototype.change = function () {
    this.id = _pyfunc_op_add(this.id, "x");
    return null;
};



    return Vue.component('mother',{
        "name": mother,
        "props": [],
        "template": `#tpl-mother`,
        "data": function() {
            var props=[]
            for(var n of []) props.push( this.$props[n] )
            var i = new C(...props)
            return JSON.parse(JSON.stringify( i ));
        },
        "computed": {
            
        },
        "methods": {
            "change": C.prototype.change,
        },
        "watch": {
            
        },
        
    })
})();

    
</script>

<div id="app">
    <mother/>
</div>
<script>new Vue({el:"#app"})</script>    
